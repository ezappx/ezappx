<html lang='en' xmlns:th='http://www.thymeleaf.org'>
<head>
    <link rel='stylesheet' type="text/css" href="http://cdn.ezappx.com/css/grapes.min.css">
    <link rel='stylesheet' type="text/css" href="http://cdn.ezappx.com/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/designer.css}"/>

    <script src="http://cdn.ezappx.com/js/grapes.js"></script>
    <script src="http://cdn.ezappx.com/js/jquery-3.3.1.min.js"></script>
    <script src="http://cdn.ezappx.com/js/popper.min.js"></script>
    <script src="http://cdn.ezappx.com/js/bootstrap.min.js"></script>

    <script src="http://cdn.ezappx.com/js/grapesjs-blocks-basic.min.js"></script>
    <script src="http://cdn.ezappx.com/js/ezapp-plugin-ajax.min.js"></script>
    <script src="http://cdn.ezappx.com/js/ezapp-plugin-export.min.js"></script>
    <script src="http://cdn.ezappx.com/js/ezapp-plugin-weui.min.js"></script>
    <title>Ezappx</title>
</head>

<body>
<div id="gjs" style="height:0px; overflow:hidden"></div>

<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loading-title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                </div>
            </div>
            <!-- <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div> -->
        </div>
    </div>
</div>

<script type="text/javascript" th:inline="javascript">

     const editor = grapesjs.init({
         height: '100%',
         showOffsets: 1,
         noticeOnUnload: 0,
         storageManager: {
             id: 'gjs-',
             type: 'local',
             autosave: true,
             autoload: true,
             stepBeforeSave: 1
         },
         container: '#gjs',
         fromElement: true,

         plugins: ['ezapp-plugin-ajax', 'gjs-blocks-basic', 'ezapp-plugin-export', 'ezapp-plugin-weui'],
         pluginsOpts: {
             'ezapp-plugin-export': {
                 username: /*[[${username}]]*/ 'default-user',
                 projectName: /*[[${username}]]*/ 'default-project',
                 uploadApi: '/upload/projectFile',
                 exportApi: '/export/mobileAppProject'
             }
         },

         canvas: {
             styles: ['http://cdn.ezappx.com/css/weui.min.css'],
             scripts: ['http://cdn.ezappx.com/js/jquery-3.3.1.min.js'],
         },

         assetManager: {
             upload: /*[[${uploadApi}]]*/ 0,
             uploadName: 'files',
             params: {
                 'username': /*[[${username}]]*/ 'default-user',
                 'projectName': /*[[${username}]]*/ 'default-project'
             }
         },

         deviceManager: {
             devices: [
                 {name: '选择设备', width:''},
                 {name: 'Android', width: '500px', height: "888px"},
                 {name: 'Android 横屏', height: '500px', width: "888px"}
             ],
             deviceLabel: 'Device',
         }
     });

    editor.Commands.add('canvas-clear', function () {
        if (confirm('确认清除画布?')) {
            editor.DomComponents.clear();
            setTimeout(function () {
                localStorage.clear()
            }, 0)
        }
    });

    let pn = editor.Panels;
    pn.addButton('options', {
        id: 'clean-canvas',
        className: 'fa fa-trash',
        command: function () {
            editor.runCommand('canvas-clear')
        },
        attributes: {
            'title': '清空画布',
            'data-tooltip-pos': 'bottom',
        },
    });

    pn.addButton('options', {
        id: 'user-logout',
        className: 'fa fa-sign-out',
        command: function () {
            console.log("logout");
            location.href = "/logout";
        },
        attributes: {
            'title': '注销',
            'data-tooltip-pos': 'bottom',
        },
    });

    window.editor = editor;
</script>
</body>