/*! ezapp-plugin-export - 0.0.42 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("grapesjs")):"function"==typeof define&&define.amd?define(["grapesjs"],t):"object"==typeof exports?exports["ezapp-plugin-export"]=t(require("grapesjs")):e["ezapp-plugin-export"]=t(e.grapesjs)}(window,function(e){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(0),i=(o=a)&&o.__esModule?o:{default:o};t.default=i.default.plugins.add("ezapp-plugin-export",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.getConfig().stylePrefix,o=document.createElement("BUTTON");o.innerHTML="导出应用安装包",o.className=n+"btn-prim",e.Commands.add("ezapp-export",{run:function(){console.log(t),$("#"+t.tipDivId).html('<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">\n                  <div class="modal-dialog" role="document">\n                    <div class="modal-content">\n                      <div class="modal-header">\n                        <h5 class="modal-title" id="loading-title"></h5>\n                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                          <span aria-hidden="true">&times;</span>\n                        </button>\n                      </div>\n                      <div class="modal-body">\n                        <div class="progress">\n                          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100"\n                            aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>\n                        </div>\n                      </div>\n                      \x3c!-- <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n                            <button type="button" class="btn btn-primary">Save changes</button>\n                          </div> --\x3e\n                    </div>\n                  </div>\n                </div>'),$("#loading").modal(),console.log("show waiting dialog");var n='<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="stylesheet" href="./css/style.css">',o="</head><body>",a="</body><html>",i='<link href="',l='" rel="stylesheet">',s='<script src="',r='"><\/script>',d=t.username,c=t.projectName,u=e.getDevice(),p=n,f=t.uploadApi,g=t.exportApi,m=[];$.each(e.getConfig().canvas.styles,function(e,t){p=p+i+t+l}),$.each(e.getConfig().canvas.scripts,function(e,t){p=p+s+t+r});var y={username:d,projectName:c,mobileOS:u,filePath:"./index.html",content:p=p+o+e.getHtml()+a};$.ajax({type:"POST",url:f,data:JSON.stringify(y),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,beforeSend:function(){$("#loading-title").text("导出HTML资源···")},success:function(e){console.log(e),""!=e.fileId&&m.push(e.fileId)},failure:function(e){$("#loading-title").text(data.status)},error:function(e,t,n){404==e.status&&$("#loading-title").text(n)}});var b={username:d,projectName:c,mobileOS:u,filePath:"./css/style.css",content:e.getCss()};$.ajax({type:"POST",url:f,data:JSON.stringify(b),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,beforeSend:function(){$("#loading-title").text("导出CSS资源···")},success:function(e){console.log(e),""!=e.fileId&&m.push(e.fileId)},failure:function(e){$("#loading-title").text(data.status)},error:function(e,t,n){404==e.status&&$("#loading-title").text(n)}});var x=new Date($.now()),v={username:d,projectName:c,createdAt:x,updatedAt:x,mobileOS:u,binaryFiles:m,cordovaPlugins:[]};console.log(v),console.log(JSON.stringify(v)),$.ajax({type:"POST",url:g,data:JSON.stringify(v),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,beforeSend:function(){$("#loading-title").text("编译打包应用···")},success:function(e){console.log(e),null==e.downloadUrl||""==e.downloadUrl||e.downloadUrl.endsWith("null")?$("#loading-title").text("编译应用失败"):(window.location.href=e.downloadUrl,$("#loading-title").text(e.status))},failure:function(e){$("#loading-title").text(data.status)},error:function(e,t,n){404==e.status&&$("#loading-title").text(n)}})}}),e.on("run:export-template",function(){e.Modal.getContentEl().appendChild(o),o.onclick=function(){e.runCommand("ezapp-export")}})})}])});
//# sourceMappingURL=ezapp-plugin-export.min.js.map